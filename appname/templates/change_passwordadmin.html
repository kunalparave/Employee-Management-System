{% extends 'admin_base.html' %}

{% block main %}

<!-- SweetAlert for Better Alerts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script type="text/javascript">
    function checkPassword() {
        let newPassword = document.changepassword.newpassword.value;
        let confirmPassword = document.changepassword.confirmpassword.value;

        if (newPassword !== confirmPassword) {
            Swal.fire({
                icon: 'error',
                title: 'Password Mismatch!',
                text: 'New Password and Confirm Password do not match.',
                confirmButtonColor: '#ff4500'
            });
            return false;
        }
        return true;
    }

    // Toggle Password Visibility
    function togglePassword(fieldId, iconId) {
        let field = document.getElementById(fieldId);
        let icon = document.getElementById(iconId);
        if (field.type === "password") {
            field.type = "text";
            icon.classList.replace("fa-eye", "fa-eye-slash");
        } else {
            field.type = "password";
            icon.classList.replace("fa-eye-slash", "fa-eye");
        }
    }
</script>

<div class="card shadow-lg border-0 rounded-4 m-4">
    <div class="card-body">
        <h4 class="p-3 text-white bg-gradient" 
            style="background: linear-gradient(90deg, #ff8c00, #ff4500); border-radius: 10px;">
            <i class="fas fa-key"></i> Change Password
        </h4>

        <div class="container-fluid mt-3">
            <form method="post" name="changepassword" onsubmit="return checkPassword()">
                {% csrf_token %}
                <div class="row g-3">
                    <!-- Current Password -->
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="password" id="currentpassword" name="currentpassword" class="form-control" placeholder="Enter Current Password">
                            <label for="currentpassword"><i class="fas fa-lock"></i> Current Password</label>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div class="col-md-6">
                        <div class="form-floating position-relative">
                            <input type="password" id="newpassword" name="newpassword" class="form-control" placeholder="Enter New Password">
                            <label for="newpassword"><i class="fas fa-key"></i> New Password</label>
                            <i class="fas fa-eye password-toggle position-absolute" 
                               onclick="togglePassword('newpassword', 'toggleNewPassword')" 
                               id="toggleNewPassword" 
                               style="top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer;">
                            </i>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="col-md-6">
                        <div class="form-floating position-relative">
                            <input type="password" id="confirmpassword" name="confirmpassword" class="form-control" placeholder="Confirm Password">
                            <label for="confirmpassword"><i class="fas fa-lock"></i> Confirm Password</label>
                            <i class="fas fa-eye password-toggle position-absolute" 
                               onclick="togglePassword('confirmpassword', 'toggleConfirmPassword')" 
                               id="toggleConfirmPassword" 
                               style="top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer;">
                            </i>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="col-md-12 text-center mt-3">
                        <button type="submit" class="btn btn-lg btn-success px-4">
                            <i class="fas fa-save"></i> Update Password
                        </button>
                    </div>
                </div>
            </form>
        </div>        
    </div>
</div>

<!-- Password Change Alerts -->
{% if error == "no" %}
<script>
    Swal.fire({
        icon: 'success',
        title: 'Password Updated!',
        text: 'You have successfully changed your password.',
        confirmButtonColor: '#28a745'
    }).then(() => {
        window.location = '{% url "logout" %}';
    });
</script>
{% endif %}

{% if error == "yes" %}
<script>
    Swal.fire({
        icon: 'error',
        title: 'Something went wrong!',
        text: 'Please try again.',
        confirmButtonColor: '#dc3545'
    });
</script>
{% endif %}

{% if error == "not" %}
<script>
    Swal.fire({
        icon: 'warning',
        title: 'Incorrect Password!',
        text: 'Your current password is incorrect.',
        confirmButtonColor: '#ffc107'
    });
</script>
{% endif %}

{% endblock %}
